---
import { getEntry } from "astro:content";
import R2Image from "./R2Image.astro";
import { getEphemeraImagePath } from "../lib/ephemera";

interface Props {
  /** The item ID to display */
  itemId: string;
  showCaption?: boolean;
}

const { itemId, showCaption = false } = Astro.props;

const item = await getEntry("ephemera", itemId);
---

{
  !item ? (
    <p class="ephemera-empty">Ephemera not found.</p>
  ) : (
    <figure data-id={item.id}>
      <a
        class="ephemera-item"
        href={`/ephemera/${item.id}`}
        class="ephemera-link"
      >
        <div class="ephemera-image-frame">
          {/* Width should match the max width of the image-frame */}
          <R2Image
            src={getEphemeraImagePath(
              item.data.images[0],
              item.data.hasTransparency
            )}
            width={280}
            alt={item.data.name}
            class="ephemera-image"
            fit="scale-down"
            sizes="(max-width: 640px) 100vw, 280px"
          />
        </div>

        {showCaption && (
          <figcaption class="ephemera-content">
            <p>{item.data.name}</p>
          </figcaption>
        )}
      </a>
    </figure>
  )
}

<style>
  .ephemera-item {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .ephemera-image-frame {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 200px;
    padding: 2rem;
    background: #f9fafb;
  }

  .ephemera-image {
    max-width: 100%;
    max-height: 100%;
    width: auto;
    height: auto;
    object-fit: scale-down;
    transition: transform 0.2s ease;
  }

  .ephemera-content {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .ephemera-link {
    display: block;
    text-decoration: none;
  }

  .ephemera-link:hover .ephemera-image {
    transform: scale(1.02);
  }

  .ephemera-name {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 600;
  }

  .ephemera-name a {
    color: #111827;
    text-decoration: none;
    transition: color 0.15s;
  }

  .ephemera-name a:hover {
    color: #4f46e5;
  }

  .ephemera-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem 1rem;
    font-size: 0.875rem;
    color: #6b7280;
  }

  .ephemera-empty {
    color: #6b7280;
    font-style: italic;
  }

  /* @media (min-width: 640px) {
    .ephemera-image-frame {
      width: 280px;
      height: 180px;
    }
  } */
</style>
