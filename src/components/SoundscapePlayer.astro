---
import type { CollectionEntry } from "astro:content";
import { getEntry } from "astro:content";
import { R2_BASE_URL } from "../lib/config";

interface Props {
  /** Pass a soundscape entry directly from the collection */
  entry?: CollectionEntry<"soundscapes">;
  /** Or pass the soundscape ID to look up */
  id?: string;
}

const { entry: propsEntry, id } = Astro.props;

// Resolve the entry: use provided entry, or fetch by ID
const entry =
  propsEntry ?? (id ? await getEntry("soundscapes", id) : undefined);
---

{
  entry && (
    <figure>
      <audio controls preload="metadata">
        <source
          src={`${R2_BASE_URL}/soundscapes/${entry.data.file}`}
          type="audio/mp4"
        />
      </audio>
      <figcaption>
        {entry.data.title} â€” {entry.data.location}, {entry.data.country}
      </figcaption>
    </figure>
  )
}
